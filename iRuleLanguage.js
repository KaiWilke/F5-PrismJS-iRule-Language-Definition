// Disclaimer : Definition of Prism.js iRule language based on TCL 8.4 and TMOS 16.1.3 commands.
//
// Author     : Kai Wilke (kw@itacs.de)
// Date       : 05.03.2023
// Version    : v1.0 (Build 1000.1)
// License    : GNU General Public License v3.0
//
// Credits    : The language definition is partially based on the TCL language definition created
//              by Peter Chaplin (https://github.com/PeterChaplin). I used his definition but then
//              heavily customized the entire definition file to improve detection, boost performance
//              and to include F5 specific commands.

Prism.languages.irule={
	comment:{pattern:/(^|\;)[\t ]*#.*/m,lookbehind:!0},
	string:{pattern:/"(?:[^"\\\r\n]|\\(?:\r\n|[\s\S]))*"/,greedy:!0},
	variable:[{pattern:/\$(?:::)?(?:[a-zA-Z0-9()]+::)*(?:\w+\(\w+\)|\w+)/,lookbehind:!0},{pattern:/(\$)\{[^}]+\}/,lookbehind:!0},{pattern:/((^|\[|\{|\;)[\t ]*(?:append|foreach|incr|info[\t ]*exists|lappend|set)[ \t]+)(?:::)?(?:[a-zA-Z0-9]+::)*(?:\w+\(\w+\)|\w+)/m,lookbehind:!0,greedy:!0}],
	builtin:[{pattern:/(^|\[|\{|\;)[\t ]*(?:break|continue|e(?:rror|val)|for(?:|each)|if|return|switch|while)\b/m,lookbehind:!0,greedy:!0},/\b(?:then|else(?:|if)|default)\b/],
	keyword:{pattern:/(^|\[|\{|\;)[\t ]*(?:a(?:ppend|rray)|binary|c(?:atch|lock|oncat)|e(?:ncoding|xpr)|format|global|i(?:ncr|nfo)|join|l(?:append|index|insert|ist|length|range|replace|search|set|sort)|r(?:ead|egexp|egsub)|s(?:can|et|plit|tring|ubst)|trace|u(?:nset|plevel|pvar)|variable)\b/m,lookbehind:!0,greedy:!0},
	f5keyword:{pattern:/(^|\[|\{|\;)[\t ]*(?:A(?:AA::(?:acct_result|acct_send|auth_result|auth_send)|CCESS::(?:acl|disable|enable|ephemeral-auth|flowid|log|oauth|perflow|policy|respond|restrict_irule_events|saml|session|user|uuid)|CL::(?:action|eval)|DAPT::(?:allow|context_(?:create|current|delete_all|name|static)|enable|preview_size|result|select|service_down_action|timeout)|ES::(?:decrypt|encrypt|key)|NTIFRAUD::(?:alert_(?:additional_info|component|defined_value|details|expected_value|fingerprint|guid|html|http_referrer|id|license_id|min|origin|resolved_value|score|transaction_(?:data|id)|type|username|view_id)|client_id|device_id|disable(?:|_alert|_app_layer_encryption|_auto_transactions|_injection|_malware|_phishing)|enable(?:|_log)|fingerprint|geo|guid|result|username)|SM::(?:captcha(?:|_age|_status)|client_ip|conviction|deception|disable|enable|fingerprint|microservice|payload|policy|raise|severity|signature|status|support_id|threat_campaign|unblock|uncaptcha|violation(?:|_data))|SN1::(?:decode|element|encode)|UTH::(?:abort|authenticate(?:|_continue)|cert(?:|_issuer)_credential|last_event_session_id|password_credential|response_data|ssl_cc_ldap_(?:status|username)|start|status|subscribe|unsubscribe|username_credential|wantcredential_(?:prompt(?:|_style)|type))|VR::(?:disable(?:|_cspm_injection)|enable))|B(?:IGPROTO::enable_fix_reset|IGTCP::release_flow|OTDEFENSE::(?:action|bot_(?:anomalies|categories|name|signature(?:|_category))|captcha_(?:age|status)|client_(?:class|type)|cookie_(?:age|status)|cs_(?:allowed|attribute|possible)|device_id|disable|enable|intent|micro_service|previous_(?:action|request_age|support_id)|reason|support_id)|WC::(?:color|debug|mark|measure|policy|pps|priority|rate))|C(?:ACHE::(?:accept_encoding|age|disable(?:|d)|enable|expire|header(?:|s)|hits|payload|priority|trace|uri|user(?:agent|key))|ATEGORY::(?:analytics|filetype|lookup|matchtype|result|safesearch)|LASSIFICATION::(?:app|category|disable|enable|protocol|result|urlcat|username)|LASSIFY::(?:application|category|defer|disable|urlcat|username)|OMPRESS::(?:buffer_size|disable|enable|gzip|method|nodelay)|ONNECTOR::(?:disable|enable|profile|remap)|RYPTO::(?:decrypt|encrypt|hash|keygen|sign|verify))|D(?:ATAGRAM::(?:dns|ip|ip6|l2|tcp|udp)|ECOMPRESS::(?:disable|enable)|HCP::version|HCPv4::(?:chaddr|ciaddr|drop|giaddr|hlen|hops|htype|len|opcode|option|reject|secs|siaddr|type|xid|yiaddr)|HCPv6::(?:drop|hop_count|len|link_address|msg_type|option|peer_address|reject|transaction_id)|IAMETER::(?:avp|command|disconnect|drop|dynamic_route_(?:insertion|lookup)|header|host|is_re(?:quest|sponse|transmission)|length|message|payload|persist|realm|respond|result|retransmi(?:ssion(?:|_default|_reason)|t)|retry|route_status|session|skip_capabilities_exchange|state)|NS::(?:additional|answer|authority|class|disable|drop|edns0|enable|header|is_wideip|last_act|len|log|name|origin|ptype|query|question|rdata|return|rpz_policy|rr|scrape|tsig|ttl|type)|NSMSG::(?:header|record|section)|OSL7::(?:disable|enable|health|is_ip_slowdown|is_mitigated|profile|slowdown)|SLITE::remote_addr)|F(?:IX::tag|LOW::(?:create_related|idle_(?:duration|timeout)|peer|priority|refresh|this)|LOWTABLE::(?:count|limit)|TP::(?:allow_active_mode|disable|enable|enforce_tls_session_reuse|ftps_mode|port))|G(?:ENERICMESSAGE::(?:message|peer|route)|TP::(?:clone|discard|forward|header|ie|length|message|new|parse|payload|respond|tunnel))|H(?:A::status|SL::(?:open|send)|TML::(?:comment|disable|enable|tag)|TTP2::(?:active|concurrency|dis(?:able|connect)|enable|header|push|requests|stream|version)|TTP::(?:close|co(?:llect|okie)|disable|enable|fallback|has_responded|header|host|hsts|is_(?:keepalive|redirect)|method|pass(?:through_reason|word)|path|payload|proxy|query|re(?:direct|ject_reason|lease|quest|spond|sponse|try)|status|uri|username|version))|I(?:CAP::(?:header|method|status|uri)|KE::(?:auth_success|cert|san_(?:dirname|dns|ediparty|email|ipadd|othername|rid|uri|x400)|subjectAltName)|LX::(?:call|init|notify)|MAP::(?:activation_mode|disable|enable)|P::(?:addr|client_addr|hops|idle_timeout|intelligence|local_addr|protocol|remote_addr|reputation|server_addr|stats|tos|ttl|version)|PFIX::(?:destination|msg|template)|SESSION::deduplication|STATS::(?:get|incr|remove|set)|VS_ENTRY::result)|L(?:7CHECK::protocol|B::(?:bias|class|co(?:mmand|nnect|nnlimit)|detach|down|enable_decisionlog|mode|persist|queue|reselect|server|snat|status|up)|DAP::activation_mode|DAP::(?:dis|en)able|INK::(?:(?:last|next)hop|qos|vlan_id)|SN::(?:address|disable|inbound-entry|inbound|persistence-entry|persistence|pool|port))|M(?:ESSAGE::(?:field|proto|type)|QTT::(?:clean_session|client_id|collect|dis(?:able|connect)|drop|dup|enable|insert|keep_alive|length|message|packet_id|password|payload|protocol_(?:name|version)|qos|re(?:lease|place|spond|tain|turn_code(?:|_list))|session_present|topic|type|username|will)|R::(?:available_for_routing|collect|connect(?:_back_port|ion_instance|ion_mode)|equivalent_transport|flow_id|ignore_peer_port|instance|max_retries|message|payload|peer|prime|protocol|re(?:lease|store|try|turn)|store|stream|transport))|N(?:SH::(?:chain|context|md1|mocksf|path_id|service_index)|TLM::(?:disable|enable))|O(?:FFBOX::request|NECONNECT::(?:detach|label|reuse|select))|P(?:CP::re(?:ject|quest|sponse)|EM::(?:(?:dis|en)able|flow|session|subscriber)|OLICY::(?:controls|names|rules|targets)|OP3::(?:activation_mode|(?:dis|en)able)|ROFILE::(?:access|antifraud|auth|avr|clientssl|diameter|ex(?:change|ists)|fast(?:L4|http)|ftp|http(?:|2|compression)|list|oneconnect|persist|serverssl|stream|tcp|tftp|udp|vdi|webacceleration|xml)|ROTOCOL_INSPECTION::(?:disable|id)|SC::(?:aaa_reporting_interval|attr|calling_id|imeisv|imsi|ip_address|lease_time|policy|subscriber_id|tower_id|user_name)|SM::(?:FTP::(?:dis|en)able|HTTP::(?:dis|en)able|SMTP::(?:dis|en)able))|R(?:ADIUS::(?:avp|code|id|rtdom|subscriber)|ESOLVER::(?:name_lookup|summarize)|EWRITE::(?:(?:dis|en)able|payload|post_process)|OUTE::(?:age|bandwidth|clear|cwnd|domain|expiration|mtu|rtt(?:|var))|TSP::(?:collect|header|method|msg_source|payload|release|respond|status|uri|version))|S(?:CTP::(?:(?:client|local|server)_port|collect|mss|payload|ppi|re(?:lease|mote_port|spond)|rto_(?:initial|max|min)|sack_timeout)|DP::(?:field|media|session_id)|IP::(?:call_id|discard|from|header|message|method|payload|persist|re(?:cord-route|spond|sponse)|route(?:|_status)|to|uri|via)|IPALG::(?:hairpin(?:|_default)|nonregister_subscriber_listener)|MTPS::(?:activation_mode|(?:dis|en)able)|OCKS::(?:allowed|destination|version)|SL::(?:allow_(?:dynamic_record_sizing|nonssl)|alpn|authenticate|c3d|cert(?:|_constraint)|cipher|clientrandom|collect|disable|enable|extensions|forward_proxy|handshake|is_renegotiation_secure|maximum_record_size|mod(?:e|ssl_sessionid_headers)|payload|profile|re(?:lease|negotiate|spond)|secure_renegotiation|session(?:|id|secret|ticket)|sni|tls13_secret|unclean_shutdown|verify_result)|TATS::(?:get|incr|set(?:|max|min))|TREAM::(?:disable|en(?:able|coding)|expression|ma(?:tch|x_matchsize)|replace))|T(?:AP::(?:action|config|insight(?:|_requested)|score)|CP::(?:abc|analytics|autowin|bandwidth|client_port|close|collect|congestion|delayed_ack|dsack|earlyrxmit|ecn|enhanced_loss_recovery|idletime|keepalive|limxmit|local_port|lossfilter(?:|burst|rate)|mss|nagle(?:|mode)|naglestate|notify|offset|option|pacing|payload|proxybuffer(?:|high|low)|push_flag|rcv_s(?:cale|ize)|recvwnd|release|remote_port|respond|rexmt_thresh|rt_metrics_timeout|rto|rtt(?:|var)|sendbuf|server_port|setmss|snd_(?:cwnd|scale|ssthresh|wnd)|unused_port)|MM::cmp_(?:count|group(?:|s)|primary_group|unit))|U(?:DP::(?:debug_queue|drop|hold|(?:client|local|server|remote|unused)_port|max_(?:buf_pkts|rate)|mss|payload|re(?:lease|spond)|sendbuffer)|RI::(?:basename|compare|(?:en|de)code|host|path|port|protocol|query))|VALIDATE::protocol|W(?:AM::(?:en|dis)able|EBSSO::(?:(?:en|dis)able|select)|S::(?:collect|disconnect|enabled|frame|masking|message|payload|re(?:lease|quest|sponse)))|X(?:509::(?:cert_fields|extensions|hash|issuer|not_valid_(?:after|before)|pem2der|serial_number|signature_algorithm|subject(?:|_public_key(?:|_RSA_bits|_type))|verify_cert_error_string|version|whole)|LAT::(?:listen(?:|_lifetime)|src_(?:addr|config|endpoint_reservation|nat_valid_range|port))|ML::(?:(?:en|dis)able|payload))|a(?:ctive_(?:members|nodes)|fter)|b64(?:de|en)code|c(?:all|lass|lient(?:_(?:addr|port)|side)|lo(?:n|s)e|onnect|pu|rc32)|d(?:ecode_uri|iscard|omain|rop)|event|f(?:asthash|ind(?:class|str)|orward)|getfield|h(?:ton(?:l|s)|ttp_(?:cookie|header|host|method|uri|version))|i(?:file|mid|p_(?:protocol|tos|ttl))|l(?:asthop|ink_qos|isten|lookup|ocal_addr|og)|m(?:atchclass|d5|embers)|n(?:exthop|ode(?:|s)|toh(?:l|s))|p(?:eer|em_dtos|ersist|ool|riority|roc)|r(?:ateclass|ecv|edirect|eject|elate_(?:client|server)|emote_addr|md160)|s(?:end|erver(?:_(?:addr|port)|side)|ession|ha(?:1|256|384|512)|haredvar|nat(?:|pool)|ubstr)|t(?:able|iming|raffic_group|ranslate)|u(?:rlcat(?:|blind)query|se)|v(?:irtual|lan_id)|w(?:hen|hereis))\b/m,lookbehind:!0,greedy:!0,alias:"keyword"},
	f5removed:{pattern:/(^|\[|\{|\;)[\t ]*(?:auto_(?:execok|import|load|mkindex|mkindex_old|qualify|reset)|bgerror|cd|e(?:xec|xit)|f(?:configure|ile|ilename)|glob|http|load|memory|open|p(?:kg(?:::create|_mkindex)|wd)|s(?:ocket|ource)|tcl_findLibrary|unknown)\b/m,lookbehind:!0,greedy:!0,alias:"keyword"},
	f5denied:{pattern:/(^|\[|\{|\;)[\t ]*(?:eof|f(?:blocked|copy|ileevent|lush)|gets|interp|namespace|p(?:ackage|id)|rename|seek|t(?:ell|ime)|update|vwait)\b/m,lookbehind:!0,greedy:!0,alias:"keyword"},
	operator:/!=?|\*\*?|==|&&?|\|\|?|<[=<]?|>[=>]?|[-+~\/%?^]|\b(?:not|and|or|contains|ends_with|eq(?:uals|)|matches_(?:glob|regex)|ne|starts_with)\b/,
	punctuation:/[{}()\[\];]/
};
